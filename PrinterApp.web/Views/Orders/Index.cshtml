@model IEnumerable<PrinterApp.Models.ViewModels.OrderViewModel>

@{
    ViewData["Title"] = "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª";
    var currentFilter = ViewData["CurrentFilter"] as string;
    var currentStatus = ViewData["CurrentStatus"] as string;
    var currentStage = ViewData["CurrentStage"] as string;
}

<div class="content-container">
    <div class="page-header">
        <h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
        <a asp-action="Create" class="btn-primary-custom">
            â• Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert-custom alert-success-custom">
            âœ“ @TempData["Success"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert-custom alert-error-custom">
            âœ— @TempData["Error"]
        </div>
    }

    <!-- Quick Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <a asp-action="Index" asp-route-status="" class="card-custom" style="text-decoration: none; padding: 20px; text-align: center; @(string.IsNullOrEmpty(currentStatus) ? "border: 2px solid var(--primary-color);" : "")">
            <div style="font-size: 32px; font-weight: bold; color: var(--primary-color);">@Model.Count()</div>
            <div style="color: var(--medium-gray); margin-top: 5px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
        </a>
        
        <a asp-action="Index" asp-route-status="Pending" class="card-custom" style="text-decoration: none; padding: 20px; text-align: center; @(currentStatus == "Pending" ? "border: 2px solid var(--warning-color);" : "")">
            <div style="font-size: 32px; font-weight: bold; color: var(--warning-color);">@Model.Count(o => o.Status == PrinterApp.Models.Entities.OrderStatus.Pending)</div>
            <div style="color: var(--medium-gray); margin-top: 5px;">Ù…Ø¹Ù„Ù‚</div>
        </a>
        
        <a asp-action="Index" asp-route-status="InManufacturing" class="card-custom" style="text-decoration: none; padding: 20px; text-align: center; @(currentStatus == "InManufacturing" ? "border: 2px solid var(--info-color);" : "")">
            <div style="font-size: 32px; font-weight: bold; color: var(--info-color);">@Model.Count(o => o.Status == PrinterApp.Models.Entities.OrderStatus.InManufacturing)</div>
            <div style="color: var(--medium-gray); margin-top: 5px;">Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠØ¹</div>
        </a>
        
        <a asp-action="Index" asp-route-status="InPrinting" class="card-custom" style="text-decoration: none; padding: 20px; text-align: center; @(currentStatus == "InPrinting" ? "border: 2px solid var(--success-color);" : "")">
            <div style="font-size: 32px; font-weight: bold; color: var(--success-color);">@Model.Count(o => o.Status == PrinterApp.Models.Entities.OrderStatus.InPrinting)</div>
            <div style="color: var(--medium-gray); margin-top: 5px;">Ù‚ÙŠØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
        </a>
        
        <a asp-action="Index" asp-route-status="Completed" class="card-custom" style="text-decoration: none; padding: 20px; text-align: center; @(currentStatus == "Completed" ? "border: 2px solid var(--success-color);" : "")">
            <div style="font-size: 32px; font-weight: bold; color: var(--success-color);">@Model.Count(o => o.Status == PrinterApp.Models.Entities.OrderStatus.Completed)</div>
            <div style="color: var(--medium-gray); margin-top: 5px;">Ù…ÙƒØªÙ…Ù„</div>
        </a>
    </div>

    <!-- Search and Filters -->
    <div class="card-custom" style="margin-bottom: 20px;">
        <div style="padding: 20px;">
            <form asp-action="Index" method="get" id="searchForm">
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px; position: relative;">
                        <input type="text"
                               name="searchTerm"
                               id="searchInput"
                               value="@currentFilter"
                               class="form-control-custom"
                               placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø§Ù„Ù…Ù†ØªØ¬..."
                               style="padding-right: 100px;" />

                        @if (!string.IsNullOrEmpty(currentFilter))
                        {
                            <button type="button"
                                    id="clearSearch"
                                    style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: var(--error-color); cursor: pointer; font-size: 20px; padding: 5px 10px;"
                                    title="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«">
                                âœ•
                            </button>
                        }
                    </div>

                    <button type="submit" class="btn-primary-custom" style="white-space: nowrap;">
                        ğŸ” Ø¨Ø­Ø«
                    </button>

                    @if (!string.IsNullOrEmpty(currentFilter) || !string.IsNullOrEmpty(currentStatus) || !string.IsNullOrEmpty(currentStage))
                    {
                        <a asp-action="Index" class="btn-secondary-custom" style="white-space: nowrap;">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </a>
                    }
                </div>
            </form>
        </div>
    </div>

    <!-- Orders Table -->
    @if (Model.Any())
    {
        <div class="card-custom">
            <div style="overflow-x: auto;">
                <table class="table-custom">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th style="width: 10%;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                            <th style="width: 15%;">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th style="width: 15%;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th style="width: 8%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th style="width: 10%;">Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                            <th style="width: 10%;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th style="width: 10%;">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                            <th style="text-align: center; width: 12%;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr style="@(order.IsLate ? "background-color: #fff3cd;" : "")">
                                <td>
                                    <span style="background: var(--primary-light); color: var(--white); padding: 5px 12px; border-radius: var(--border-radius-sm); font-weight: bold; font-family: monospace;">
                                        @order.OrderNumber
                                    </span>
                                </td>
                                <td>@order.OrderDate.ToString("dd/MM/yyyy")</td>
                                <td>
                                    <strong>@order.CustomerName</strong>
                                </td>
                                <td>@order.ProductName</td>
                                <td style="text-align: center;">
                                    <span style="background: var(--info-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-weight: bold;">
                                        @order.Quantity
                                    </span>
                                </td>
                                <td>
                                    @order.ExpectedDeliveryDate.ToString("dd/MM/yyyy")
                                    @if (order.IsLate)
                                    {
                                        <span style="color: var(--error-color); font-weight: bold;">âš ï¸ Ù…ØªØ£Ø®Ø±</span>
                                    }
                                </td>
                                <td>
                                    @switch (order.Status)
                                    {
                                        case PrinterApp.Models.Entities.OrderStatus.Pending:
                                            <span style="background: var(--warning-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                â³ Ù…Ø¹Ù„Ù‚
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.UnderReview:
                                            <span style="background: var(--info-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                ğŸ“ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.InManufacturing:
                                            <span style="background: var(--primary-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                âš™ï¸ Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠØ¹
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.InPrinting:
                                            <span style="background: var(--info-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                ğŸ–¨ï¸ Ù‚ÙŠØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.Completed:
                                            <span style="background: var(--success-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                âœ“ Ù…ÙƒØªÙ…Ù„
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.Cancelled:
                                            <span style="background: var(--error-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                âœ— Ù…Ù„ØºÙŠ
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStatus.OnHold:
                                            <span style="background: var(--medium-gray); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;">
                                                â¸ï¸ Ù…Ø¹Ù„Ù‚ Ù…Ø¤Ù‚ØªØ§Ù‹
                                            </span>
                                            break;
                                    }
                                </td>
                                <td>
                                    @switch (order.Stage)
                                    {
                                        case PrinterApp.Models.Entities.OrderStage.Order:
                                            <span style="background: var(--medium-gray); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px;">
                                                1ï¸âƒ£ Ø·Ù„Ø¨
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStage.Review:
                                            <span style="background: var(--info-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px;">
                                                2ï¸âƒ£ Ù…Ø±Ø§Ø¬Ø¹Ø©
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStage.Manufacturing:
                                            <span style="background: var(--warning-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px;">
                                                3ï¸âƒ£ ØªØµÙ†ÙŠØ¹
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStage.Printing:
                                            <span style="background: var(--primary-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px;">
                                                4ï¸âƒ£ Ø·Ø¨Ø§Ø¹Ø©
                                            </span>
                                            break;
                                        case PrinterApp.Models.Entities.OrderStage.Completed:
                                            <span style="background: var(--success-color); color: var(--white); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 12px;">
                                                âœ“ Ù…ÙƒØªÙ…Ù„
                                            </span>
                                            break;
                                    }
                                </td>
                                <td style="text-align: center;">
                                    <div class="action-buttons" style="justify-content: center;">
                                        <a asp-action="Details" asp-route-id="@order.Id" class="btn-primary-custom btn-sm-custom" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                            ğŸ‘ï¸
                                        </a>

                                        @if (order.Stage == PrinterApp.Models.Entities.OrderStage.Order)
                                        {
                                            <a asp-action="Edit" asp-route-id="@order.Id" class="btn-warning-custom btn-sm-custom" title="ØªØ¹Ø¯ÙŠÙ„">
                                                âœï¸
                                            </a>
                                            
                                            @if (order.Status != PrinterApp.Models.Entities.OrderStatus.Cancelled)
                                            {
                                                <form asp-action="MoveToReview" asp-route-id="@order.Id" method="post" style="display:inline;">
                                                    @Html.AntiForgeryToken()
                                                    <button type="submit" class="btn-success-custom btn-sm-custom" title="Ù†Ù‚Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">
                                                        â¡ï¸
                                                    </button>
                                                </form>
                                            }
                                        }

                                        @if (order.Status != PrinterApp.Models.Entities.OrderStatus.Completed && order.Status != PrinterApp.Models.Entities.OrderStatus.Cancelled)
                                        {
                                            <button type="button" class="btn-danger-custom btn-sm-custom" onclick="showCancelModal(@order.Id)" title="Ø¥Ù„ØºØ§Ø¡">
                                                ğŸš«
                                            </button>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="card-custom">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“‹</div>
                <h3 style="color: var(--medium-gray);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                <p style="color: var(--medium-gray);">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø·Ù„Ø¨</p>
                <a asp-action="Create" class="btn-primary-custom" style="margin-top: 20px;">
                    â• Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                </a>
            </div>
        </div>
    }
</div>

<!-- Cancel Order Modal -->
<div id="cancelModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div class="card-custom" style="max-width: 500px; margin: 50px auto;">
        <div style="padding: 20px;">
            <h3>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</h3>
            <form id="cancelForm" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" id="cancelOrderId" name="id" />
                <div style="margin: 20px 0;">
                    <label class="form-label">Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</label>
                    <textarea name="reason" class="form-control-custom" rows="4" required placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn-secondary-custom" onclick="closeCancelModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn-danger-custom">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showCancelModal(orderId) {
            document.getElementById('cancelOrderId').value = orderId;
            document.getElementById('cancelForm').action = '/Orders/Cancel/' + orderId;
            document.getElementById('cancelModal').style.display = 'flex';
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').style.display = 'none';
        }

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearch');

        if (clearSearchBtn) {
            clearSearchBtn.addEventListener('click', function() {
                searchInput.value = '';
                document.getElementById('searchForm').submit();
            });
        }
    </script>
}
