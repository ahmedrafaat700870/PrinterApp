@model PrinterApp.Models.ViewModels.OrderStage1ViewModel

@{
    ViewData["Title"] = "ุชุนุฏูู ุงูุทูุจ";
}

<div class="content-container">
    <div class="page-header">
        <h2>โ๏ธ ุชุนุฏูู ุงูุทูุจ - @Model.OrderNumber</h2>
        <a asp-action="Details" asp-route-id="@Model.Id" class="btn-secondary-custom">
            โ ุนูุฏุฉ ููุชูุงุตูู
        </a>
    </div>

    <div class="card-custom">
        <div style="padding: 30px;">
            <form asp-action="Edit" method="post" enctype="multipart/form-data">
                <input type="hidden" asp-for="Id" />
                <div asp-validation-summary="ModelOnly" class="alert-custom alert-error-custom"></div>

                <!-- ูุนูููุงุช ุฃุณุงุณูุฉ -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
                        ๐ ูุนูููุงุช ุฃุณุงุณูุฉ
                    </h4>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label asp-for="OrderNumber" class="form-label"></label>
                            <input asp-for="OrderNumber" class="form-control-custom" placeholder="ุฃุฏุฎู ุฑูู ุงูุทูุจ" />
                            <span asp-validation-for="OrderNumber" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="OrderDate" class="form-label"></label>
                            <input asp-for="OrderDate" class="form-control-custom" type="date" />
                            <span asp-validation-for="OrderDate" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="ExpectedDeliveryDate" class="form-label"></label>
                            <input asp-for="ExpectedDeliveryDate" class="form-control-custom" type="date" />
                            <span asp-validation-for="ExpectedDeliveryDate" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงูุนููู ูุงูููุชุฌ -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
                        ๐ฅ ูุนูููุงุช ุงูุนููู ูุงูููุชุฌ
                    </h4>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label asp-for="CustomerId" class="form-label"></label>
                            <select asp-for="CustomerId" class="form-control-custom" asp-items="ViewBag.Customers">
                                <option value="">-- ุงุฎุชุฑ ุงูุนููู --</option>
                            </select>
                            <span asp-validation-for="CustomerId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="SupplierId" class="form-label"></label>
                            <select asp-for="SupplierId" class="form-control-custom" asp-items="ViewBag.Suppliers" id="supplierSelect">
                                <option value="">-- ุงุฎุชุฑ ุงูููุฑุฏ --</option>
                            </select>
                            <span asp-validation-for="SupplierId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="ProductId" class="form-label"></label>
                            <select asp-for="ProductId" class="form-control-custom" asp-items="ViewBag.Products" id="productSelect">
                                <option value="">-- ุงุฎุชุฑ ุงูููุชุฌ --</option>
                            </select>
                            <span asp-validation-for="ProductId" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- ููุงุตูุงุช ุงูููุชุฌ -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
                        ๐ ููุงุตูุงุช ุงูููุชุฌ
                    </h4>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label asp-for="RawMaterialId" class="form-label"></label>
                            <select asp-for="RawMaterialId" class="form-control-custom" asp-items="ViewBag.RawMaterials">
                                <option value="">-- ุงุฎุชุฑ ููุน ุงูุฎุงู --</option>
                            </select>
                            <span asp-validation-for="RawMaterialId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="RollDirectionId" class="form-label"></label>
                            <select asp-for="RollDirectionId" class="form-control-custom" asp-items="ViewBag.RollDirections">
                                <option value="">-- ุงุฎุชุฑ ุงุชุฌุงู ุงูุฑูู (ุงุฎุชูุงุฑู) --</option>
                            </select>
                            <span asp-validation-for="RollDirectionId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Length" class="form-label"></label>
                            <input asp-for="Length" class="form-control-custom" type="number" step="0.01" placeholder="ุงูุทูู ุจุงูุณูุชููุชุฑ" />
                            <span asp-validation-for="Length" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Width" class="form-label"></label>
                            <input asp-for="Width" class="form-control-custom" type="number" step="0.01" placeholder="ุงูุนุฑุถ ุจุงูุณูุชููุชุฑ" />
                            <span asp-validation-for="Width" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Quantity" class="form-label"></label>
                            <input asp-for="Quantity" class="form-control-custom" type="number" placeholder="ุฃุฏุฎู ุงููููุฉ" />
                            <span asp-validation-for="Quantity" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- ููุงุญุธุงุช ููููุงุช -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
                        ๐ ููุงุญุธุงุช ููุฑููุงุช
                    </h4>

                    <div class="form-group" style="margin-bottom: 20px;">
                        <label asp-for="OrderNotes" class="form-label"></label>
                        <textarea asp-for="OrderNotes" class="form-control-custom" rows="4" placeholder="ุฃุฏุฎู ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ..."></textarea>
                        <span asp-validation-for="OrderNotes" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ุฅุถุงูุฉ ูุฑููุงุช ุฌุฏูุฏุฉ</label>
                        <input type="file" name="files" class="form-control-custom" multiple accept=".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx,.bmp" />
                        <small style="color: var(--medium-gray);">ููููู ุฑูุน ูููุงุช ูุชุนุฏุฏุฉ (ุงูุญุฏ ุงูุฃูุตู 10 ููุฌุงุจุงูุช ููู ููู)</small>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 15px; justify-content: flex-end; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    <a asp-action="Details" asp-route-id="@Model.Id" class="btn-secondary-custom">
                        โ ุฅูุบุงุก
                    </a>
                    <button type="submit" class="btn-primary-custom">
                        โ ุญูุธ ุงูุชุนุฏููุงุช
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Filter products by supplier
        document.getElementById('supplierSelect').addEventListener('change', function() {
            const supplierId = this.value;
            const productSelect = document.getElementById('productSelect');
            
            if (supplierId) {
                fetch('/Orders/GetProductsBySupplier?supplierId=' + supplierId)
                    .then(response => response.json())
                    .then(data => {
                        productSelect.innerHTML = '<option value="">-- ุงุฎุชุฑ ุงูููุชุฌ --</option>';
                        data.forEach(product => {
                            productSelect.innerHTML += `<option value="${product.id}">${product.name}</option>`;
                        });
                    })
                    .catch(error => console.error('Error:', error));
            }
        });

        // Check order number uniqueness
        document.querySelector('input[name="OrderNumber"]').addEventListener('blur', function() {
            const orderNumber = this.value;
            const orderId = @Model.Id;
            if (orderNumber) {
                fetch('/Orders/CheckOrderNumber?orderNumber=' + encodeURIComponent(orderNumber) + '&excludeId=' + orderId)
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            alert('ุฑูู ุงูุทูุจ ููุฌูุฏ ูุณุจูุงู. ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุฑูู ุขุฎุฑ.');
                            this.focus();
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    </script>
}
