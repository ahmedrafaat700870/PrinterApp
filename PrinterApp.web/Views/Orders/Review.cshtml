@model PrinterApp.Models.ViewModels.OrderStage2ViewModel

@{
    ViewData["Title"] = "ูุฑุงุฌุนุฉ ุงูุทูุจ";
}

<div class="content-container">
    <div class="page-header">
        <h2>๐ ูุฑุงุฌุนุฉ ุงูุทูุจ - @Model.OrderNumber</h2>
        <a asp-action="ReviewList" class="btn-secondary-custom">
            โ ุนูุฏุฉ ูููุงุฆูุฉ
        </a>
    </div>

    <div class="card-custom">
        <div style="padding: 30px;">
            <!-- Order Summary -->
            <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">ููุฎุต ุงูุทูุจ</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>ุงูุนููู:</strong> @Model.CustomerName</div>
                    <div><strong>ุงูููุชุฌ:</strong> @Model.ProductName</div>
                    <div><strong>ุงููููุฉ:</strong> @Model.Quantity</div>
                    <div><strong>ุงูููุงุณ:</strong> @Model.Length ร @Model.Width ุณู</div>
                </div>
            </div>

            <form asp-action="Review" method="post">
                <input type="hidden" asp-for="Id" />
                <div asp-validation-summary="ModelOnly" class="alert-custom alert-error-custom"></div>

                <!-- Equipment Selection -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px;">โ๏ธ ุงููุนุฏุงุช ุงููุทููุจุฉ</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label asp-for="MachineId" class="form-label"></label>
                            <select asp-for="MachineId" class="form-control-custom" asp-items="ViewBag.Machines" required>
                                <option value="">-- ุงุฎุชุฑ ุงููุงูููุฉ --</option>
                            </select>
                            <span asp-validation-for="MachineId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="CoreId" class="form-label"></label>
                            <select asp-for="CoreId" class="form-control-custom" asp-items="ViewBag.Cores" required>
                                <option value="">-- ุงุฎุชุฑ ุงูููุจ --</option>
                            </select>
                            <span asp-validation-for="CoreId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="KnifeId" class="form-label"></label>
                            <select asp-for="KnifeId" class="form-control-custom" asp-items="ViewBag.Knives" required>
                                <option value="">-- ุงุฎุชุฑ ุงูุณูููุฉ --</option>
                            </select>
                            <span asp-validation-for="KnifeId" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="CartonId" class="form-label"></label>
                            <select asp-for="CartonId" class="form-control-custom" asp-items="ViewBag.Cartons">
                                <option value="">-- ุงุฎุชุฑ ุงููุฑุชูู (ุงุฎุชูุงุฑู) --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label asp-for="MoldId" class="form-label"></label>
                            <select asp-for="MoldId" class="form-control-custom" asp-items="ViewBag.Molds">
                                <option value="">-- ุงุฎุชุฑ ุงููุงูุจ (ุงุฎุชูุงุฑู) --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Manufacturing Additions -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px;">๐ง ุงูุฅุถุงูุงุช ุงูุชุตููุนูุฉ</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                        @foreach (var addition in ViewBag.ManufacturingAdditions)
                        {
                            <label style="display: flex; align-items: center; padding: 12px; background: var(--white); border: 2px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; transition: all 0.2s;">
                                <input type="checkbox" name="SelectedManufacturingAdditions" value="@addition.Id" 
                                       @(Model.SelectedManufacturingAdditions?.Contains(addition.Id) == true ? "checked" : "")
                                       style="margin-left: 10px; width: 20px; height: 20px; cursor: pointer;" />
                                <span style="flex: 1;">@addition.AdditionName</span>
                            </label>
                        }
                    </div>
                </div>

                <!-- Review Notes -->
                <div style="background: var(--input-bg); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 20px;">๐ ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ</h4>
                    <textarea asp-for="ReviewNotes" class="form-control-custom" rows="4" placeholder="ุฃุฏุฎู ุฃู ููุงุญุธุงุช ูููุฑุงุฌุนุฉ..."></textarea>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: 15px; justify-content: flex-end; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    <a asp-action="ReviewList" class="btn-secondary-custom">โ ุฅูุบุงุก</a>
                    <button type="submit" class="btn-primary-custom">โ ุญูุธ ุงููุฑุงุฌุนุฉ</button>
                </div>
            </form>

            <!-- Move to Manufacturing -->
            @if (Model.MachineId.HasValue && Model.CoreId.HasValue && Model.KnifeId.HasValue)
            {
                <form asp-action="MoveToManufacturing" asp-route-id="@Model.Id" method="post" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    @Html.AntiForgeryToken()
                    <div style="text-align: center;">
                        <button type="submit" class="btn-success-custom" style="font-size: 16px; padding: 12px 30px;">
                            โก๏ธ ููู ุฅูู ูุฑุญูุฉ ุงูุชุตููุน
                        </button>
                    </div>
                </form>
            }
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
