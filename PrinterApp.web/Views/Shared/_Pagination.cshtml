@model dynamic

@{
    var pageIndex = (int)ViewData["PageIndex"];
    var totalPages = (int)ViewData["TotalPages"];
    var totalCount = (int)ViewData["TotalCount"];
    var pageSize = (int)ViewData["PageSize"];
    var hasPreviousPage = (bool)ViewData["HasPreviousPage"];
    var hasNextPage = (bool)ViewData["HasNextPage"];
    
    // Get current route values
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
    
    // Get query parameters
    var searchTerm = ViewData["CurrentFilter"] as string;
    var status = ViewData["CurrentStatus"] as string;
    var stage = ViewData["CurrentStage"] as string;
    var fromDate = ViewData["FromDate"] as string;
    var toDate = ViewData["ToDate"] as string;
}

@if (totalPages > 1)
{
    <div class="pagination-container" style="margin-top: 20px;">
        <div class="pagination-info">
            <span style="color: var(--medium-gray);">
                عرض @((pageIndex - 1) * pageSize + 1) - @(Math.Min(pageIndex * pageSize, totalCount)) من @totalCount
            </span>
        </div>
        
        <ul class="pagination">
            <!-- First Page -->
            @if (pageIndex > 1)
            {
                <li class="page-item">
                    <a class="page-link" 
                       asp-controller="@currentController" 
                       asp-action="@currentAction"
                       asp-route-pageNumber="1"
                       asp-route-searchTerm="@searchTerm"
                       asp-route-status="@status"
                       asp-route-stage="@stage"
                       asp-route-fromDate="@fromDate"
                       asp-route-toDate="@toDate"
                       title="الصفحة الأولى">
                        ⏮️
                    </a>
                </li>
            }
            
            <!-- Previous Page -->
            @if (hasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link" 
                       asp-controller="@currentController" 
                       asp-action="@currentAction"
                       asp-route-pageNumber="@(pageIndex - 1)"
                       asp-route-searchTerm="@searchTerm"
                       asp-route-status="@status"
                       asp-route-stage="@stage"
                       asp-route-fromDate="@fromDate"
                       asp-route-toDate="@toDate"
                       title="الصفحة السابقة">
                        ◀️
                    </a>
                </li>
            }
            
            <!-- Page Numbers -->
            @{
                var startPage = Math.Max(1, pageIndex - 2);
                var endPage = Math.Min(totalPages, pageIndex + 2);
                
                // Adjust if at the beginning
                if (pageIndex <= 3)
                {
                    endPage = Math.Min(5, totalPages);
                }
                
                // Adjust if at the end
                if (pageIndex > totalPages - 3)
                {
                    startPage = Math.Max(1, totalPages - 4);
                }
            }
            
            @if (startPage > 1)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }
            
            @for (var i = startPage; i <= endPage; i++)
            {
                <li class="page-item @(i == pageIndex ? "active" : "")">
                    <a class="page-link" 
                       asp-controller="@currentController" 
                       asp-action="@currentAction"
                       asp-route-pageNumber="@i"
                       asp-route-searchTerm="@searchTerm"
                       asp-route-status="@status"
                       asp-route-stage="@stage"
                       asp-route-fromDate="@fromDate"
                       asp-route-toDate="@toDate">
                        @i
                    </a>
                </li>
            }
            
            @if (endPage < totalPages)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }
            
            <!-- Next Page -->
            @if (hasNextPage)
            {
                <li class="page-item">
                    <a class="page-link" 
                       asp-controller="@currentController" 
                       asp-action="@currentAction"
                       asp-route-pageNumber="@(pageIndex + 1)"
                       asp-route-searchTerm="@searchTerm"
                       asp-route-status="@status"
                       asp-route-stage="@stage"
                       asp-route-fromDate="@fromDate"
                       asp-route-toDate="@toDate"
                       title="الصفحة التالية">
                        ▶️
                    </a>
                </li>
            }
            
            <!-- Last Page -->
            @if (pageIndex < totalPages)
            {
                <li class="page-item">
                    <a class="page-link" 
                       asp-controller="@currentController" 
                       asp-action="@currentAction"
                       asp-route-pageNumber="@totalPages"
                       asp-route-searchTerm="@searchTerm"
                       asp-route-status="@status"
                       asp-route-stage="@stage"
                       asp-route-fromDate="@fromDate"
                       asp-route-toDate="@toDate"
                       title="الصفحة الأخيرة">
                        ⏭️
                    </a>
                </li>
            }
        </ul>
        
        <!-- Page Size Selector -->
        <div class="page-size-selector">
            <label for="pageSize" style="margin-left: 10px;">عدد العناصر:</label>
            <select id="pageSize" 
                    class="form-control-custom" 
                    style="width: 80px; display: inline-block;"
                    onchange="changePageSize(this.value)">
                <option value="10" selected="@(pageSize == 10)">10</option>
                <option value="25" selected="@(pageSize == 25)">25</option>
                <option value="50" selected="@(pageSize == 50)">50</option>
                <option value="100" selected="@(pageSize == 100)">100</option>
            </select>
        </div>
    </div>
}

<style>
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .pagination-info {
        font-weight: bold;
    }
    
    .pagination {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 5px;
    }
    
    .page-item {
        margin: 0;
    }
    
    .page-link {
        display: block;
        padding: 8px 12px;
        text-decoration: none;
        color: var(--primary-color);
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        transition: all 0.3s;
        min-width: 40px;
        text-align: center;
    }
    
    .page-link:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }
    
    .page-item.active .page-link {
        background: var(--primary-color);
        color: white;
        font-weight: bold;
        border-color: var(--primary-color);
    }
    
    .page-item.disabled .page-link {
        color: var(--medium-gray);
        cursor: not-allowed;
        background: #f8f9fa;
    }
    
    .page-item.disabled .page-link:hover {
        background: #f8f9fa;
        transform: none;
    }
    
    .page-size-selector {
        display: flex;
        align-items: center;
    }
    
    @@media (max-width: 768px) {
        .pagination-container {
            flex-direction: column;
        }
        
        .pagination {
            flex-wrap: wrap;
            justify-content: center;
        }
    }
</style>

<script>
    function changePageSize(size) {
        const url = new URL(window.location.href);
        url.searchParams.set('pageSize', size);
        url.searchParams.set('pageNumber', '1'); // Reset to first page
        window.location.href = url.toString();
    }
</script>
